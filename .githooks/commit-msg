#!/usr/bin/env sh
set -eu

MSG_FILE="$1"
MSG=$(sed -n '1p' "$MSG_FILE")

# Conventional Commits regex: type(scope)?: subject
# Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
if echo "$MSG" | grep -Eq '^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?!?: .+'; then
  exit 0
else
  printf "\nCommit message must follow Conventional Commits.\n"
  printf "Example: 'feat(api): add transcript gating'\n\n"
  exit 1
fi
